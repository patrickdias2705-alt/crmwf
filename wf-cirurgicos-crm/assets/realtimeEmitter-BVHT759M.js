var h=Object.defineProperty;var m=(s,e,n)=>e in s?h(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var o=(s,e,n)=>m(s,typeof e!="symbol"?e+"":e,n);import{s as y}from"./index-DQK8bEkD.js";const i=class i{constructor(){o(this,"channels",new Map)}static getInstance(){return this.instance||(this.instance=new i),this.instance}getChannel(e){const n=`tenant_${e}`;if(!this.channels.has(n)){const t=y.channel(n);this.channels.set(n,t)}return this.channels.get(n)}async emit({type:e,payload:n,tenant_id:t}){if(!t){console.error("‚ùå Cannot emit realtime event without tenant_id");return}try{const a=this.getChannel(t),r={data:n,timestamp:new Date().toISOString(),tenant_id:t};console.log("üì§ Emitting realtime event:",e,r),await a.send({type:"broadcast",event:e,payload:r}),console.log("‚úÖ Realtime event emitted successfully")}catch(a){console.error("‚ùå Failed to emit realtime event:",a)}}async emitLeadCreated(e,n){await this.emit({type:"lead.created",payload:e,tenant_id:n})}async emitLeadStageChanged(e,n,t,a){await this.emit({type:"lead.stage_changed",payload:{lead:e,from_stage:n,to_stage:t},tenant_id:a})}async emitMessageReceived(e,n,t,a){await this.emit({type:"message.received",payload:{message:e,conversation:n,lead:t,from:(t==null?void 0:t.phone)||(t==null?void 0:t.name),text:e.text,lead_id:t==null?void 0:t.id},tenant_id:a})}async emitMessageSent(e,n,t,a){await this.emit({type:"message.sent",payload:{message:e,conversation:n,lead:t,to:(t==null?void 0:t.phone)||(t==null?void 0:t.name),text:e.text,lead_id:t==null?void 0:t.id},tenant_id:a})}async emitConversationStarted(e,n,t){await this.emit({type:"conversation.started",payload:{conversation:e,lead:n,lead_id:n==null?void 0:n.id},tenant_id:t})}async emitLeadScheduled(e,n){await this.emit({type:"lead.scheduled",payload:e,tenant_id:n})}async emitLeadClosed(e,n){await this.emit({type:"lead.closed",payload:e,tenant_id:n})}async emitLeadLost(e,n,t){await this.emit({type:"lead.lost",payload:{lead:e,reason:n},tenant_id:t})}};o(i,"instance");let c=i;const w=c.getInstance();export{c as RealtimeEmitter,w as realtimeEmitter};
